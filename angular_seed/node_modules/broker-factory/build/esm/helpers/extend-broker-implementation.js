var _this = this;
import * as tslib_1 from "tslib";
import { PORT_MAP } from './port-map';
export var extendBrokerImplementation = function (partialBrokerImplementation) {
    // @todo The spread operator can't be used here because TypeScript does not believe that partialBrokerImplementation is an object.
    return Object.assign({}, partialBrokerImplementation, {
        connect: function (_a) {
            var call = _a.call;
            return function () { return tslib_1.__awaiter(_this, void 0, void 0, function () {
                var _a, port1, port2, portId;
                return tslib_1.__generator(this, function (_b) {
                    switch (_b.label) {
                        case 0:
                            _a = new MessageChannel(), port1 = _a.port1, port2 = _a.port2;
                            return [4 /*yield*/, call('connect', { port: port1 }, [port1])];
                        case 1:
                            portId = _b.sent();
                            PORT_MAP.set(port2, portId);
                            return [2 /*return*/, port2];
                    }
                });
            }); };
        },
        disconnect: function (_a) {
            var call = _a.call;
            return function (port) { return tslib_1.__awaiter(_this, void 0, void 0, function () {
                var portId;
                return tslib_1.__generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            portId = PORT_MAP.get(port);
                            if (portId === undefined) {
                                throw new Error('The given port is not connected.');
                            }
                            return [4 /*yield*/, call('disconnect', { portId: portId })];
                        case 1:
                            _a.sent();
                            return [2 /*return*/];
                    }
                });
            }); };
        }
    });
};
//# sourceMappingURL=/build/es2015/helpers/extend-broker-implementation.js.map
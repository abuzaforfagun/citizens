import { generateUniqueNumber } from 'fast-unique-numbers';
import { renderUnknownPortIdError } from './error-renderers';
var CLEAN_UP_FUNCTIONS = new Map();
export var extendWorkerImplementation = function (createWorker, partialWorkerImplementation) {
    // @todo The spread operator can't be used here because TypeScript does not believe that partialWorkerImplementation is an object.
    return Object.assign({}, partialWorkerImplementation, {
        connect: function (_a) {
            var port = _a.port;
            port.start();
            var destroyWorker = createWorker(port, partialWorkerImplementation);
            var portId = generateUniqueNumber(CLEAN_UP_FUNCTIONS);
            CLEAN_UP_FUNCTIONS.set(portId, function () {
                destroyWorker();
                port.close();
                CLEAN_UP_FUNCTIONS.delete(portId);
            });
            return { result: portId };
        },
        disconnect: function (_a) {
            var portId = _a.portId;
            var cleanUp = CLEAN_UP_FUNCTIONS.get(portId);
            if (cleanUp === undefined) {
                throw renderUnknownPortIdError({ portId: portId.toString() });
            }
            cleanUp();
            return { result: null };
        }
    });
};
//# sourceMappingURL=/build/es2015/helpers/extend-worker-implementation.js.map